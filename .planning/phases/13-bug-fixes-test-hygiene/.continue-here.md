---
phase: 13-bug-fixes-test-hygiene
task: fix zlib_client fixture regression
total_tasks: 1
status: in_progress
last_updated: 2026-02-11
---

<current_state>
Phase 13 plans (13-01, 13-02) executed and verified 5/5 must-haves. However, a regression was discovered: the 13-02 executor removed the `zlib_client` pytest fixture when rewriting `TestRealAuthentication` to use EAPIClient, but 16 other integration test classes still depend on that fixture. All integration tests (with real credentials) fail with "fixture 'zlib_client' not found" (18 errors).

Two signals logged about dependency-blind changes.
</current_state>

<completed_work>

- 13-01-PLAN: Fix test configuration and stale assertions — DONE (3 commits)
- 13-02-PLAN: Remove deprecated AsyncZlib references — DONE (3 commits)
- Phase verification: PASSED 5/5 must-haves
- ROADMAP.md and STATE.md updated to mark phase 13 complete
- Signal: sig-2026-02-11-executor-missed-fixture-dependency (critical, deviation)
- Signal: sig-2026-02-11-gsd-phantom-file-dependencies (critical, config-mismatch)
</completed_work>

<remaining_work>

- Fix `zlib_client` fixture regression in `__tests__/python/integration/test_real_zlibrary.py`
  - The fixture was already missing BEFORE 13-02 (investigation showed `git show ac73961^` also had no fixture definition — it was lost in an earlier commit)
  - Need to create a proper `zlib_client` fixture using EAPIClient
  - The `client=zlib_client` param passed to `python_bridge.search()` is actually IGNORED — `search()` always calls `get_eapi_client()` internally. So the fixture mainly ensures auth happens before tests run.
  - Also pre-existing: `booklist_tools.py:62` has `discover_eapi_domain()` missing required arg, and `test_inline_footnotes.py` has a flaky markerless continuation test
</remaining_work>

<decisions_made>

- User wants to `/clear` context and use `/gsd:quick` to fix this more carefully
- The fixture regression is the priority fix
- Two signals were logged to capture the dependency-awareness pattern
</decisions_made>

<blockers>
- None — straightforward fix, just needs careful dependency analysis this time
</blockers>

<context>
The user is frustrated by a pattern of dependency-blind changes: the executor modified a shared symbol without checking downstream consumers, and the GSD framework itself has phantom file references (knowledge-store.md, kb-templates/signal.md, kb-rebuild-index.sh all referenced but never created). The user wants a clean context restart to approach the fixture fix more carefully.

Key finding during investigation: `python_bridge.search(client=...)` accepts `client` param but NEVER uses it — it always calls `get_eapi_client()`. So the `zlib_client` fixture serves as an auth-initialization step, not dependency injection. The fix should create an EAPIClient-based fixture that authenticates and can be passed to tests, even though most tests don't actually use the injected client.
</context>

<next_action>
Start with: `/gsd:quick` to fix the `zlib_client` fixture. Create a module-scoped async fixture that instantiates EAPIClient, calls login(), and yields the client. Verify with `uv run pytest __tests__/python/integration/test_real_zlibrary.py --collect-only` first (no credentials needed to check fixture resolution), then full run if credentials available.
</next_action>
