# pyproject.toml - UV-based dependency management (v2.0.0)
#
# Z-Library MCP server with modern UV dependency management
# Setup: uv sync (creates .venv and installs dependencies)

[project]
name = "zlibrary-mcp"
version = "2.0.0"
description = "Z-Library MCP server for AI assistants"
readme = "README.md"
requires-python = ">=3.10"
authors = [
    { name = "loganrooks" }
]
keywords = ["mcp", "zlibrary", "ai", "books", "library"]
license = { text = "MIT" }

# Core dependencies for zlibrary-mcp functionality
# Based on actual usage from lib/*.py analysis
dependencies = [
    # Vendored zlibrary (installed from local ./zlibrary directory)
    "zlibrary",
    # Document processing
    "pymupdf>=1.26.0", # PDF processing (fitz)
    "ebooklib>=0.19", # EPUB processing
    # HTTP and async
    "httpx>=0.28.0", # HTTP client (used in booklists, advanced_search)
    "aiofiles>=24.1.0", # Async file operations
    # HTML parsing
    "beautifulsoup4>=4.14.0", # HTML parsing
    "lxml>=6.0.0", # XML/HTML parser (bs4 backend)
    # NLP for footnote detection
    "nltk>=3.8.1", # Sentence boundary detection
    "ocrmypdf>=15.4.4",
    "opencv-python-headless>=4.12.0.88",
]

# UV source configuration for vendored zlibrary
# This tells UV to install zlibrary from local path as editable
[tool.uv.sources]
zlibrary = { path = "./zlibrary", editable = true }

# Optional dependencies
[project.optional-dependencies]
# OCR capabilities for scanned PDFs (not currently active)
ocr = [
    "pytesseract>=0.3.10",
    "pdf2image>=1.16.0",
    "pillow>=11.0.0",
]

# Development and testing
dev = [
    "pytest>=8.4.0",
    "pytest-asyncio>=1.2.0",
    "pytest-mock>=3.15.0",
    "pytest-benchmark>=5.1.0",
]

[project.urls]
Homepage = "https://github.com/loganrooks/zlibrary-mcp"
Repository = "https://github.com/loganrooks/zlibrary-mcp.git"
Issues = "https://github.com/loganrooks/zlibrary-mcp/issues"

[build-system]
requires = ["setuptools>=68", "wheel"]
build-backend = "setuptools.build_meta"

# Note: This project is primarily Node.js/TypeScript
# pyproject.toml is used for Python dependency management only
# The MCP server is built with: npm run build (TypeScript compilation)

# UV-specific configuration
[tool.uv]
# Development dependencies (alternative syntax)
dev-dependencies = [
    "pytest>=8.4.0",
    "pytest-asyncio>=1.2.0",
    "pytest-mock>=3.15.0",
    "pytest-benchmark>=5.1.0",
    "ruff>=0.14.14",
]

# Constraints to fix security vulnerabilities in transitive deps
constraint-dependencies = [
    "aiohttp>=3.13.3",       # CVE-2025-69223 through CVE-2025-69230
    "brotli>=1.2.0",         # CVE-2025-6176
    "pdfminer.six>=20251230", # CVE-2025-64512, GHSA-f83h-ghpp-7wcc
]

# Ruff configuration
[tool.ruff.lint]
# E402: Module-level import not at top of file
# Required because lib/ and __tests__/ scripts manipulate sys.path before imports
ignore = ["E402"]

# E741: Ambiguous variable names (single-letter vars in comprehensions)
extend-ignore = ["E741"]

# UV configuration options
[tool.uv.pip]
# Use PyPI as default index
index-url = "https://pypi.org/simple"

# Notes:
# - zlibrary will be installed as editable from ./zlibrary
# - All transitive dependencies handled automatically
# - uv.lock will be generated on first: uv sync
# - To add deps: uv add package-name
# - To install optional: uv sync --extra ocr
