/**
 * Simplified venv-manager for UV (v2.0.0)
 *
 * UV automatically creates and manages .venv/ in the project directory.
 * This module just provides the path to UV's Python executable.
 *
 * COMPARISON:
 * - v1.x: 406 lines of cache venv management
 * - v2.0: ~45 lines total (this entire file)
 * - Reduction: 89% code reduction
 *
 * DO NOT USE YET - This is an example for planning/review
 * Current implementation is in venv-manager.ts
 */

import * as path from 'path';
import { existsSync } from 'fs';
import { execSync } from 'child_process';
import { fileURLToPath } from 'url';

// Recreate __dirname for ESM
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

/**
 * Get path to UV-managed Python executable
 *
 * UV creates .venv/ in project root automatically when you run: uv sync
 * This function simply returns the path to Python in that venv.
 *
 * No cache management, no config files, no programmatic pip installation.
 * UV handles all of that.
 *
 * @returns {Promise<string>} Path to Python executable in .venv
 * @throws {Error} If .venv not found (user needs to run: uv sync)
 */
export async function getManagedPythonPath(): Promise<string> {
  const projectRoot = path.resolve(__dirname, '..', '..');
  const uvVenvPython = path.join(projectRoot, '.venv', 'bin', 'python');

  // Check if UV venv exists
  if (!existsSync(uvVenvPython)) {
    throw new Error(
      'Python virtual environment not found.\n\n' +
      'UV has not initialized the environment. Please run:\n' +
      '  uv sync\n\n' +
      'This will:\n' +
      '  1. Create .venv/ directory\n' +
      '  2. Install all dependencies from pyproject.toml\n' +
      '  3. Generate uv.lock for reproducibility\n\n' +
      'First time setup? Install UV:\n' +
      '  curl -LsSf https://astral.sh/uv/install.sh | sh\n' +
      '  # Or: pip install uv\n\n' +
      'See: https://docs.astral.sh/uv/getting-started/installation/'
    );
  }

  // Verify Python is executable and working
  try {
    const version = execSync(`"${uvVenvPython}" --version`, {
      stdio: 'pipe',
      encoding: 'utf8'
    }).trim();

    // Optional: Log Python version for debugging
    // console.log(`Using Python: ${version}`);
  } catch (error) {
    throw new Error(
      `Python at ${uvVenvPython} is not executable.\n` +
      `This usually means .venv is corrupted. Try:\n` +
      `  rm -rf .venv\n` +
      `  uv sync`
    );
  }

  return uvVenvPython;
}

// That's it! No need for:
// - getCacheDir()
// - getConfigPath()
// - readVenvPathConfig()
// - writeVenvPathConfig()
// - createVenv()
// - installDependencies()
// - ensureVenvReady()
// - checkPackageInstalled()
// - findPythonExecutable()
// - runCommand()
// - VenvManagerDependencies interface
// - defaultDeps
// - etc. (350+ lines deleted)

// UV handles all of that automatically!
