---
phase: 05-feature-porting-branch-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - zlibrary/src/zlibrary/abs.py
  - src/lib/zlibrary-api.ts
autonomous: true

must_haves:
  truths:
    - "Search results from search_books include explicit `title` and `author` string fields"
    - "Search results from full_text_search, search_advanced, search_by_author, search_by_term all include title and author"
    - "Existing fields (name, authors) preserved for backward compatibility"
    - "Missing author/title returns null (not omitted)"
  artifacts:
    - path: "zlibrary/src/zlibrary/abs.py"
      provides: "title and author string fields in search result dicts"
      contains: "title"
    - path: "src/lib/zlibrary-api.ts"
      provides: "Passes through title/author fields from Python"
  key_links:
    - from: "zlibrary/src/zlibrary/abs.py"
      to: "src/lib/zlibrary-api.ts"
      via: "Python search returns title+author, TS passes through"
---

<objective>
Enrich all search tool results with explicit `title` (string) and `author` (string) fields alongside existing `name` and `authors` fields for clearer API surface.

Purpose: Fulfills GIT-05 (author/title in search results). Additive change for backward compatibility.
Output: All 5 search tools return title and author fields.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-feature-porting-branch-cleanup/05-CONTEXT.md
@.planning/phases/05-feature-porting-branch-cleanup/05-RESEARCH.md
@zlibrary/src/zlibrary/abs.py
@src/lib/zlibrary-api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add title and author fields to Python search results</name>
  <files>zlibrary/src/zlibrary/abs.py</files>
  <action>
1. In `zlibrary/src/zlibrary/abs.py`, find the search result parsing in the `_parse_book_cards` method (or equivalent parsing logic that builds the `js` dict from `z-bookcard` elements).

2. After the existing `name` and `authors` extraction, add:
   ```python
   # Explicit title/author fields for clearer API surface
   js["title"] = js.get("name") or None
   js["author"] = js["authors"][0] if js.get("authors") else None
   ```
   This derives `title` from `name` (the book title) and `author` from the first element of `authors` list.

3. Verify this parsing applies to ALL search methods equally. The z-bookcard parsing is shared across search_books, full_text_search, search_advanced, search_by_author, and search_by_term — confirm by tracing the call chain. If any method has its own parsing, add the same fields there.

4. For the booklist endpoint (`fetch_booklist`), check if it shares the same z-bookcard parser. If yes, it gets the fields for free. If not, add them.

5. Use `None` (not omission) for missing fields — this maps to `null` in JSON, which is the explicit-missing convention.
  </action>
  <verify>
    `uv run pytest` passes. `grep -n "title.*=.*name\|author.*=.*authors" zlibrary/src/zlibrary/abs.py` shows the new field assignments.
  </verify>
  <done>
    All search result dicts include `title` (string|null) and `author` (string|null) fields. Existing `name` and `authors` fields preserved. Tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TypeScript passthrough and run full test suite</name>
  <files>src/lib/zlibrary-api.ts</files>
  <action>
1. In `src/lib/zlibrary-api.ts`, inspect all search-related methods (searchBooks, fullTextSearch, searchAdvanced, searchByAuthor, searchByTerm). Verify they pass through the Python response without field filtering — the new `title` and `author` fields should flow through automatically.

2. If any method explicitly picks fields (destructuring or mapping), add `title` and `author` to the pick list.

3. Update tool descriptions in `src/index.ts` if they enumerate returned fields — add `title` (string) and `author` (string) to the list.

4. Run the full test suite:
   - `npm run build`
   - `node --experimental-vm-modules node_modules/jest/bin/jest.js`
   - `uv run pytest`

5. Verify no regressions.
  </action>
  <verify>
    `npm run build` succeeds. All Jest and Pytest tests pass. Tool descriptions mention title/author fields.
  </verify>
  <done>
    TypeScript layer passes through title/author. Tool descriptions updated. Full test suite green.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — compiles clean
2. `uv run pytest` — Python tests pass
3. `node --experimental-vm-modules node_modules/jest/bin/jest.js` — Jest tests pass
4. `grep "title.*author" zlibrary/src/zlibrary/abs.py` confirms new fields
</verification>

<success_criteria>
- All 5 search tools return `title` and `author` string fields
- Existing `name` and `authors` fields unchanged
- Missing values represented as null
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-feature-porting-branch-cleanup/05-02-SUMMARY.md`
</output>
