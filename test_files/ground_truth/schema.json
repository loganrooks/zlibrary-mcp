{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RAG Pipeline Ground Truth Schema",
  "description": "Schema for documenting expected behavior of test PDFs",
  "type": "object",
  "required": ["test_name", "pdf_file", "features", "expected_quality"],
  "properties": {
    "test_name": {
      "type": "string",
      "description": "Unique identifier for this test"
    },
    "pdf_file": {
      "type": "string",
      "description": "Path to test PDF relative to project root"
    },
    "pages": {
      "type": "integer",
      "description": "Number of pages in PDF"
    },
    "created_date": {
      "type": "string",
      "format": "date"
    },
    "verified_by": {
      "type": "string",
      "description": "Who verified this ground truth (human name or 'automated')"
    },
    "description": {
      "type": "string"
    },
    "features": {
      "type": "object",
      "properties": {
        "xmarks": {
          "type": "array",
          "items": {"$ref": "#/definitions/xmark"}
        },
        "footnotes": {
          "type": "array",
          "items": {"$ref": "#/definitions/footnote"}
        },
        "citations": {
          "type": "array",
          "items": {"$ref": "#/definitions/citation"}
        },
        "formatting": {
          "type": "array",
          "items": {"$ref": "#/definitions/formatting"}
        }
      }
    },
    "expected_quality": {
      "type": "object",
      "required": ["quality_score_min", "processing_time_max_ms"],
      "properties": {
        "quality_score_min": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "quality_flags": {
          "type": "array",
          "items": {"type": "string"}
        },
        "processing_time_max_ms": {
          "type": "integer",
          "description": "Maximum acceptable processing time in milliseconds"
        }
      }
    },
    "validation_criteria": {
      "type": "object",
      "properties": {
        "all_xmarks_detected": {"type": "boolean"},
        "all_text_recovered": {"type": "boolean"},
        "formatting_preserved": {"type": "boolean"},
        "no_false_positives": {"type": "boolean"},
        "no_hallucinations": {"type": "boolean"}
      }
    }
  },
  "definitions": {
    "xmark": {
      "type": "object",
      "required": ["page", "word_under_erasure"],
      "properties": {
        "page": {"type": "integer"},
        "word_under_erasure": {"type": "string"},
        "bbox": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 4,
          "maxItems": 4
        },
        "corrupted_extraction": {"type": "string"},
        "expected_recovery": {"type": "string"},
        "expected_output": {"type": "string"},
        "confidence_min": {"type": "number"}
      }
    },
    "footnote": {
      "type": "object",
      "properties": {
        "page": {"type": "integer"},
        "marker": {"type": "string"},
        "text": {"type": "string"},
        "definition_page": {"type": "integer"}
      }
    },
    "citation": {
      "type": "object",
      "properties": {
        "page": {"type": "integer"},
        "text": {"type": "string"},
        "system": {"type": "string"},
        "author_hint": {"type": "string"},
        "work_hint": {"type": "string"}
      }
    },
    "formatting": {
      "type": "object",
      "properties": {
        "page": {"type": "integer"},
        "text": {"type": "string"},
        "formats": {
          "type": "array",
          "items": {"type": "string"}
        },
        "expected_output": {"type": "string"}
      }
    }
  }
}
